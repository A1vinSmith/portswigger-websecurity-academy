# Lab: High-level logic vulnerability

Lab-Link: <https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-high-level>  
Difficulty: APPRENTICE  
Python script: [script.py](script.py)  

## Known information

- Lab application does not adequately validates user input
- Logic flaw in the purchasing workflow
- Login credentials `wiener:peter`
- Goals:
  - Purchase a "Lightweight l33t leather jacket"

## Steps

### Analysis

The first step, as usual, is analysis of the website and the existing workflow for buying items. As such, I login with the given credentials and see that, again and as in real life, the available money is not enough to purchase the desired item.

This time, the request to add items into the cart does not contain the price, but just the productId and the quantity.

![add_request](img/add_request.png)

The cart now contains my jacket, the information that I can't afford it, and buttons to adjust the quantity.

![cart](img/cart.png)

Clicking on the `+` and `-` buttons perform requests similar to the one shown above, just with positive or negative quantities.

![minus_request](img/minus_request.png)

What happens if I send the `-` request again when the cart is empty?

![cart_negative](img/cart_negative.png)

Interesting. So if I purchase my leather jacket and a negative number of things so that the total is within the available store credit, it may succeed if no additional checks are in place.

So try it out. Entering a negative number in the 'add to cart'-form is not allowed (although it is a JavaScript check, so easily avoidable). But intercepting the request with Burp and changing it works just fine.

![negative_13](img/negative_13.png)

Now the cart shows a much more affordable total:

![adjusted_cart](img/adjusted_cart.png)

But with some additional purchases the price can be optimized even further (a negative total is unfortunately prevented by the application)

![almost_zero](img/almost_zero.png)

After placing the order, the lab changes to:

![success](img/success.png)

And I even get a few spare fur babies to resell.
